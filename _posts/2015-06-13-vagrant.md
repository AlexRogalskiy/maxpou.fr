---
layout: post
title: Vagrant ou le jour où j'ai définitivement lâché WAMP
description: "Présentation et installation de Vagrant"
modified: 2015-07-21
tags: [vagrant]
---

# Vagrant ou le jour où j'ai définitivement lâché WAMP

## Prérequis

* Savoir utiliser Linux en ligne de commande.

## Partons du problème

Liste des problèmes avec WAMP :  

* disparité des environnements de dev dans une équipe de développeurs (que ce soit les version de WAMP, de OS)
* difficulté à partager un environnement de dev configuré
* le traditionnel "Ben pourtant ça marche chez moi"
* impossible de tester des outils comme ElasticSearch, Varnish, Blackfire.io...
* obligation de réinstaller un nouvel environnement pour coller le plus possible à celui du client
* ... 

La solution la plus simple est alors de se créer une machine virtuelle.  
On est alors face à un autre problème : la mise en place est à la fois <u>longue</u> et pénible. De plus, il y a toujours un truc qui ne marche pas...
Et puis WAMP, c'est tellement simple à installer !

La solution ? **Vagrant** !

## Vagrant, c'est quoi

>Create and configure lightweight, reproducible, and portable development environments.</p>
[www.vagrantup.com](https://www.vagrantup.com/)

Vagrant est un outil permettant de simplifier et automatiser des machines virtuelles.

## Installation

Vous devez installer 2 choses :  

* un outil de virtualisation (virtualbox, vmware, ...)
* [Vagrant](https://www.vagrantup.com/downloads.html)

Validez l'installation en exécutant la commande suivante : `vagrant -v` dans l'invite de commande.

## Configuration

Tout cela passe par un Vagrantfile, un fichier de configuration pour la machine.  
Ce fichier contiendra divers éléments :  

* URL de la box (un squelette d'un type de machine)
* adresse IP de la machine
* son nom d'hôte
* emplacement de vos répertoires sur votre machine
* éléments à installer (mysql, apache2, nginx, ...)

Pour avoir essayé, ce n'est pas simple d'utilisation. Il faut installer plusieurs plugins et il y a souvent un truc qui ne fonctionne pas.
Nous allons donc tout générer automatiquement en passant par un outil web : [PuPHPet](https://puphpet.com).

## C'est parti !

Pour bien débuter, je vous propose de ne pas partir de zéro.  
Je me suis créé une machine qui me sert pour tester mes sites en environnement apache2/mysql sur un Debian Wheezy 7. Pour virtualiser, j'utilise Virtualbox et mes sites sont sur D:\sites.
Rassurez-vous, vous pourrez réajuster à votre goût.

Une fois que vous avez [téléchargé l'archive](https://github.com/maxpou/vagrant-sites-apache), faites un drag&drop du fichier config.yml (dans le répertoire puphpet) sur le site de PuPHPet (je n'ai réussi à le faire qu'avec Chrome).

Une fois chargé, n'hésitez pas à revenir sur la configuration et à l'adapter à votre besoin (type de serveur, emplacement de vos sites, ...).

Ensuite, il va falloir générer l'archive qui contiendra le vagrantfile.

Lancez ensuite l'invite de commande. Rendez-vous là où se trouve le Vagrantfile.
Exécutez la commande suivante : `vagrant up`

Patientez, une quinzaine de minutes.
Et voilà, rendez-vous sur l'url indiquée dans votre configuration (sites.local dans le cas présent).


## Commandes utiles

Voici quelques commandes utiles :  

* `vagrant` liste toutes les commandes 
* `vagrant up` Démarre la machine (du répertoire courant) 
* `vagrant ssh` connexion en ssh avec la machine (du répertoire courant) 
* `vagrant halt` Eteint la machine (du répertoire courant) 
* `vagrant provision` Met à jour la machine  (du répertoire courant) 
* `vagrant destroy` supprime la machine (du répertoire courant) 
* `vagrant destroy [id de la machine]` supprime la machine dont l'id est passé en paramètre 
* `vagrant global-status`affiche les machines et leurs états. C'est ici que vous pourrez retrouver l'id d'une machine. 
* `vagrant global-status --prune` même commande que celle ci-dessus. Permet de supprimer les données invalides : si vous avez supprimé une machine en supprimant les fichier, elle sera toujours dans le cache.
